# @package _global_

defaults:
  - dreamer_v3
  - override /algo: dreamer_v3_XS
  - override /env: gym
  - override /logger@metric.logger: wandb
  - _self_

# ===== Names =====
exp_name: dreamer_v3_cartpole_vector
run_name: ${now:%Y-%m-%d_%H-%M-%S}_${exp_name}_${seed}
root_dir: ${exp_name}/${env.id}
seed: 0

# ===== Algorithm (DreamerV3) =====
algo:
  total_steps: 100_000
  per_rank_batch_size: 16
  per_rank_sequence_length: 32
  dormant:
    enabled: true        # 休眠ニューロン計測を有効化
    tau: 0.25            # 休眠とみなすスコア閾値
    interval: 100        # 何ステップごとに計測するか
    batch_size: 256      # 計測に使うサンプルバッチサイズ
    sequence_length: ${algo.per_rank_sequence_length}  # 計測用シーケンス長
    num_batches: 1       # 計測で繰り返し取るバッチ数
  cnn_keys:
    encoder: []
    decoder: []
  mlp_keys:
    encoder: [state]
    decoder: [state]

# ===== Replay Buffer =====
buffer:
  share_data: False
  size: 50_000
  memmap: False

# ===== Checkpoint =====
checkpoint:
  save_last: True
  every: 20_000
  keep_last: 3

# ===== Environment (Gym CartPole) =====
env:
  id: CartPole-v1
  num_envs: 4
  sync_env: True
  action_repeat: 1
  max_episode_steps: 500
  capture_video: True
  video_every: 20

# ===== Logger (TensorBoard) =====
logger:
  project: ${exp_name}
  name: ${run_name}
  tags: ["dreamer_v3", "cartpole", "vector"]

# ===== Metric =====
metric:
  log_every: 100
  aggregator:
    metrics:
      Rewards/rew_avg:
        _target_: torchmetrics.MeanMetric
        sync_on_compute: ${metric.sync_on_compute}
      Game/ep_len_avg:
        _target_: torchmetrics.MeanMetric
        sync_on_compute: ${metric.sync_on_compute}
